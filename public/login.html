<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriCompanion - Signup and Signin</title>
    <!-- Add your CSS link here for styling -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <h1>Welcome to NutriCompanion</h1>
        <div class="buttons">
            <button id="signup-button" onclick="toggleForm('signup-form')">Sign Up</button>
            <button id="signin-button" onclick="toggleForm('signin-form')">Sign In</button>
        </div>
        <div id="signup-form" class="form" style="display: none;">
            <h2>Sign Up</h2>
            <form id="signup-form">
                <input type="text" id="signup-username" placeholder="Username" required>
                <input type="email" id="signup-email" placeholder="Email" required>
                <input type="password" id="signup-password" placeholder="Password" required>
                <button type="submit">Sign Up</button>
            </form>
        </div>
        <div id="signin-form" class="form" style="display: none;">
            <h2>Sign In</h2>
            <form id="signin-form">
                <input type="email" id="signin-email" placeholder="Email" required>
                <input type="password" id="signin-password" placeholder="Password" required>
                <button type="submit">Sign In</button>
            </form>
        </div>
    </div>
    <script>
        // Function to toggle between sign-up and sign-in forms
        function toggleForm(formId) {
            const signupForm = document.getElementById('signup-form');
            const signinForm = document.getElementById('signin-form');

            if (formId === 'signup-form') {
                signupForm.style.display = 'block';
                signinForm.style.display = 'none';
            } else if (formId === 'signin-form') {
                signupForm.style.display = 'none';
                signinForm.style.display = 'block';
            }
        }

        // Function to handle sign-up form submission
        document.getElementById('signup-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const username = document.getElementById('signup-username').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;

            // Send a POST request to your signup API endpoint with the user data
            fetch('/api/signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, email, password })
            })
                .then(response => response.json())
                .then(data => {
                    // Handle the response from your signup endpoint (e.g., show success message or error)
                    console.log(data); // You can add your logic here
                    // Redirect to /home on successful signup
                    window.location.href = '/home';
                })
                .catch(error => {
                    console.error('Error during signup:', error);
                });
        });

        // Function to handle sign-in form submission
        document.getElementById('signin-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const email = document.getElementById('signin-email').value;
            const password = document.getElementById('signin-password').value;

            // Send a POST request to your signin API endpoint with the user data
            fetch('/api/signin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email, password }),
            })
                .then((response) => response.json())
                .then((data) => {
                    // Handle the response from your signin endpoint (e.g., store JWT token or show error)
                    console.log(data); // You can add your logic here

                    // Store the token in local storage
                    localStorage.setItem('token', data.token);

                    // Redirect to /home on successful signin

                })
                .catch((error) => {
                    console.error('Error during signin:', error);
                });

            const bToken = localStorage.getItem('token');

            console.log(bToken);

            if (bToken) {
                fetch('/home', {
                    method: 'GET',
                    headers: {
                        'Bearer': bToken,
                    }
                })
                    .then((response) => response.json())
                    .then((data) => {
                        // Handle the response from your signin endpoint (e.g., store JWT token or show error)
                        console.log(data); // You can add your logic here

                        if (data.status) {

                            window.location.href = '/home';
                        }

                    })
                    .catch((error) => {
                        console.error('Error during signin:', error);
                    });
            }
        });


    </script>
</body>

</html>

<!-- .then(() => {
    fetch('/home', {
        method: 'GET',
        headers: {
            'Bearer': localStorage.getItem('token'),
        }
    })
}) -->